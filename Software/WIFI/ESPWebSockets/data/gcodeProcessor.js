var gcodeProcessor;function sameSign(e,t){return e>0&&t>0||e<0&&t<0||!(e>0&&t<0||e<0&&t>0)&&void 0}function scaleValues(e,t){for(var a=Array(4),r=0;r<4;r++)a[r]=t[r]*e;return a}function arrayEqual(e,t){for(var a=0;a<4;a++)if(e[a]!=t[a])return!1;return!0}function updatedValueInNewArray(e,t){var a;if(null!=t){a=Array(4);for(var r=0;r<4;r++)null!=t[r]?a[r]=t[r]:a[r]=e[r]}else a=e.slice();return a}function secondsToHMS(e){var t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=Math.floor(e%60),o="";return t>0&&(o+=t+":"+(a<10?"0":"")),o+=a+":"+(r<10?"0":""),o+=""+r}function GcodeProcessor(){this.results={Category0:{discription:"Time",table:"gcodeStats"},printTime:{discription:"Print Time",table:"gcodeStats"},accelerationTime:{discription:"Time Spent Accelerating/Decelerating",table:"gcodeStats"},constantSpeedTime:{discription:"Time Spent at Target Speed",table:"gcodeStats"},zHopTime:{discription:"Total Z Hop Time",table:"gcodeStats"},retractTime:{discription:"Total Retract/Prime Time",table:"gcodeStats"},Category1:{discription:"Distance",table:"gcodeStats"},totalDistance:{discription:"Total Distance Moved",table:"gcodeStats"},printDistance:{discription:"Print / Travel Move Distance",table:"gcodeStats"},accelerationDistance:{discription:"Distance Accelerating/Decelerating",table:"gcodeStats"},constantSpeedDistance:{discription:"Distance at Target Speed",table:"gcodeStats"},filamentUsage:{discription:"Raw Filament Usage",table:"gcodeStats"},filamentLineRatio:{discription:"Printed Line Length per mm of Raw Filament",table:"gcodeStats"},Category2:{discription:"Speed",table:"gcodeStats"},averageSpeed:{discription:"Average Speed",table:"gcodeStats"},printSpeed:{discription:"Average Print Speed",table:"gcodeStats"},travelSpeed:{discription:"Average Travel Speed",table:"gcodeStats"},filamentUsageRate:{discription:"Raw Filament Usage Rate",table:"gcodeStats"},xyFeedrate:{discription:"Min / Max XY Feedrate",table:"gcodeStats"},Category3:{discription:"Count",table:"gcodeStats"},numberOfLines:{discription:"Number of Lines",table:"gcodeStats"},moveCommandCount:{discription:"Total Move Commands (G0 & G1)",table:"gcodeStats"},reachTargetSpeedCount:{discription:"Move Commands Reached Target Speed",table:"gcodeStats"},moveType:{discription:"Print Move / Travel Move",table:"gcodeStats"},zHopCount:{discription:"Z Hop Count",table:"gcodeStats"},retractCount:{discription:"Retraction Count",table:"gcodeStats"},limitedMaxSpeedPerAxis:{discription:"Times Move Speed Limited By Axis Max Speed",table:"gcodeStatsPerAxis",fieldId:["limitedMaxSpeedX","limitedMaxSpeedY","limitedMaxSpeedZ","limitedMaxSpeedE"]},totalDistancePerAxis:{discription:"Total Distance Moved",table:"gcodeStatsPerAxis",fieldId:["totalDistanceX","totalDistanceY","totalDistanceZ","totalDistanceE"]},averageSpeedPerAxis:{discription:"Average Speed",table:"gcodeStatsPerAxis",fieldId:["averageSpeedX","averageSpeedY","averageSpeedZ","averageSpeedE"]}},this.processGcodes=function(e,t){this.settings=t;var a=0;this.absoluteExtrusion=this.settings.absoluteExtrusion,this.gcodes=[],this.retractedLength=0,this.currentCoord=[0,0,0,0],this.currentFanSpeed=0,this.currentFeedrate=(t.maxSpeed[0]+t.maxSpeed[1])/2,this.currentSpeedFactor=1,this.currentExtrudeFactor=1,this.currentPrintAcceleration=t.maxPrintAcceleration,this.currentTravelAcceleration=t.maxTravelAcceleration,this.movementGcodeCount=0,this.maxFanSpeed=0,this.lookAheadBuffer=t.lookAheadBuffer,this.firmwareRetractLength=t.firmwareRetractLength,this.firmwareUnretractLength=t.firmwareUnretractLength,this.firmwareRetractSpeed=60*t.firmwareRetractSpeed,this.firmwareUnretractSpeed=60*t.firmwareUnretractSpeed,this.firmwareRetractZhop=t.firmwareRetractZhop,this.zBeforeFirmwareRetractZhop=0;var r=new Gcode,o=new Gcode;r.endSpeed=[0,0,0,0],this.lastMovementGcode=r,o.endOfMovementGcode=!0,o.startSpeed=[0,0,0,0],o.maxJerk=t.maxJerk,r.nextMovementGcode=o,r.movementGcodeIndex=0;var i=r,s=r,d={},n=0,c=0,l=0,h=0,p=0,m=0,v=0,u=0,S=0,g=void 0,f=void 0,x=[0,0,0,0],M=0,G=0,C=0,F=0,T=0,b=[0,0,0,0],y=0,A=0,w=0,R=0,P=0,L=1/0,k=0,D=0,H=[],B={e:[]},E=[],U=void 0,I=0,Z=0,J=0,V=[[],[]],q=[[],[]],z=[-1/0,-1/0],X=[1/0,1/0];for(this.STHistogram=[];;){var Y;if(a<e.length)(Y=new Gcode).loadGcode(e[a]),this.processGcode(Y),Y.isMovement&&this.gcodes.push(Y),a++;else a==e.length&&(this.headMovementGcode=r.nextMovementGcode,this.lastMovementGcode.nextMovementGcode=o,a++);if((this.lastMovementGcode.movementGcodeIndex-i.movementGcodeIndex>1||a>e.length)&&!("endOfMovementGcode"in i)){if(0==i.movementGcodeIndex&&(r.calculateSpeedByJerk(),"endOfMovementGcode"in(i=r.nextMovementGcode)))break;i.calculateSpeedByJerk(),i.calculateTimeByAcceleration(),i=i.nextMovementGcode}if(this.gcodes.length>this.lookAheadBuffer||"endOfMovementGcode"in i){if(0==this.gcodes.length)break;if((s=this.gcodes.shift()).printMove){if(s.startCoord[2]!=U){if(B.e.length>0){B.o=I,I++,B.z=U,B.t=secondsToHMS(Z),Z=0,H.push(B);for(var N=0;N<2;N++)V[N].push(z[N]),q[N].push(X[N]);z=[-1/0,-1/0],X=[1/0,1/0],(B={}).e=[]}U=s.startCoord[2]}if(0==E.length){E.push([s.startCoord.slice(0,2)]);for(N=0;N<2;N++)s.startCoord[N]>z[N]&&(z[N]=s.startCoord[N]),s.startCoord[N]<X[N]&&(X[N]=s.startCoord[N])}if(extrusionsLength=s.relativeCoord[3],this.retractedLength>0&&(extrusionsLength-=this.retractedLength,this.retractedLength-=extrusionsLength,this.retractedLength<0&&(this.retractedLength=0)),extrusionsLength>0){E.push([s.endCoord.slice(0,2),extrusionsLength,s.feedrate,s.phaseDistance,[s.phaseSpeed[0],s.phaseSpeed[1],s.phaseSpeed[1],s.phaseSpeed[2]],this.currentFanSpeed]),s.phaseSpeed[1]>J&&(J=s.phaseSpeed[1]);for(N=0;N<2;N++)s.endCoord[N]>z[N]&&(z[N]=s.endCoord[N]),s.endCoord[N]<X[N]&&(X[N]=s.endCoord[N])}else E.length>0&&(B.e.push(E),E=[])}else E.length>0&&(B.e.push(E),E=[]),s.isMovement&&(s.relativeCoord[3]<0?this.retractedLength+=s.relativeCoord[3]:(this.retractedLength-=s.relativeCoord[3],this.retractedLength<0&&(this.retractedLength=0)));Z+=s.phaseTime[0],Z+=s.phaseTime[1],Z+=s.phaseTime[2];var O=Math.sqrt(s.relativeCoord[0]*s.relativeCoord[0]+s.relativeCoord[1]*s.relativeCoord[1]+s.relativeCoord[2]*s.relativeCoord[2]);s.phaseTime[0]*=this.settings.timeScale,s.phaseTime[1]*=this.settings.timeScale,s.phaseTime[2]*=this.settings.timeScale,0==s.relativeCoord[0]&&0==s.relativeCoord[1]||(P<s.feedrate&&(P=s.feedrate),L>s.feedrate&&(L=s.feedrate)),n+=s.phaseTime[0],c+=s.phaseTime[1],l+=s.phaseTime[2],1==s.reachedFeedrateScale&&v++,g=1,f=-1,(w+=s.relativeCoord[3])>R&&(R=w),0==s.relativeCoord[0]&&0==s.relativeCoord[1]&&s.relativeCoord[2]<0&&(y++,A+=2*(s.phaseTime[0]+s.phaseTime[1]+s.phaseTime[2])),(0==s.relativeCoord[0]&&0==s.relativeCoord[1]&&s.relativeCoord[3]>0||s.relativeCoord[3]<0)&&(F+=.5,T+=s.phaseTime[0]+s.phaseTime[1]+s.phaseTime[2]);for(N=0;N<4;N++)s.limitedByMaxSpeed[N]<g&&(g=s.limitedByMaxSpeed[N],f=N),b[N]+=Math.abs(s.relativeCoord[N]);C+=O=Math.sqrt(s.relativeCoord[0]*s.relativeCoord[0]+s.relativeCoord[1]*s.relativeCoord[1]+s.relativeCoord[2]*s.relativeCoord[2]),s.printMove?(u++,M+=O,k+=s.phaseTime[0]+s.phaseTime[1]+s.phaseTime[2]):0==s.relativeCoord[0]&&0==s.relativeCoord[1]&&0==s.relativeCoord[2]||(S++,G+=O,D+=s.phaseTime[0]+s.phaseTime[1]+s.phaseTime[2]),-1!=f&&x[f]++,0==s.relativeCoord[0]&&0==s.relativeCoord[1]&&0==s.relativeCoord[2]||(h+=s.phaseDistance[0],p+=s.phaseDistance[1],m+=s.phaseDistance[2],this.calculateSTHistogram(s)),s.nextMovementGcode.previousMovementGcode=void 0,s.nextMovementGcode=void 0}var j=Math.floor(100*a/e.length);j!=Math.floor(100*(a-1)/e.length)&&postMessage({progress:j})}var K=n+c+l;if(d.numberOfLines=e.length,d.printTime=secondsToHMS(K),d.accelerationTime=secondsToHMS(n+l)+" ("+(100*(n+l)/K).toFixed(1)+"%)",d.constantSpeedTime=secondsToHMS(c)+" ("+(100*c/K).toFixed(1)+"%)",d.moveCommandCount=this.movementGcodeCount,d.reachTargetSpeedCount=v+" ("+(100*v/this.movementGcodeCount).toFixed(1)+"%)",d.moveType=u+" ("+(100*u/this.movementGcodeCount).toFixed(1)+"%) / "+S+" ("+(100*S/this.movementGcodeCount).toFixed(1)+"%)",d.limitedMaxSpeedX=x[0],d.limitedMaxSpeedY=x[1],d.limitedMaxSpeedZ=x[2],d.limitedMaxSpeedE=x[3],d.totalDistance=(C/1e3).toFixed(2)+" m",d.totalDistanceX=(b[0]/1e3).toFixed(2)+" m",d.totalDistanceY=(b[1]/1e3).toFixed(2)+" m",d.totalDistanceZ=(b[2]/1e3).toFixed(2)+" m",d.totalDistanceE=(b[3]/1e3).toFixed(2)+" m",d.accelerationDistance=((h+m)/1e3).toFixed(2)+" m ("+(100*(h+m)/C).toFixed(1)+"%)",d.constantSpeedDistance=(p/1e3).toFixed(2)+" m ("+(100*p/C).toFixed(1)+"%)",d.printDistance=(M/1e3).toFixed(2)+" m ("+(100*M/C).toFixed(1)+"%) / "+(G/1e3).toFixed(2)+" m ("+(100*G/C).toFixed(1)+"%)",d.averageSpeed=(C/K).toFixed(1)+" mm/s",d.averageSpeedX=(b[0]/K).toFixed(1)+" mm/s",d.averageSpeedY=(b[1]/K).toFixed(1)+" mm/s",d.averageSpeedZ=(b[2]/K).toFixed(1)+" mm/s",d.averageSpeedE=(b[3]/K).toFixed(1)+" mm/s",d.zHopCount=y,d.zHopTime=secondsToHMS(A),d.retractCount=Math.floor(F),d.retractTime=secondsToHMS(T),d.filamentUsage=(R/1e3).toFixed(2)+" m",d.xyFeedrate=L.toFixed(2)+"mm/s / "+P.toFixed(2)+"mm/s",d.filamentUsageRate=(R/K).toFixed(2)+" mm/s, "+(R/10/K*60).toFixed(2)+" cm/min",d.filamentLineRatio=(M/R).toFixed(2)+" mm",d.printSpeed=(M/k).toFixed(1)+" mm/s",d.travelSpeed=(G/D).toFixed(1)+" mm/s",postMessage({result:d}),postMessage({histogram:this.STHistogram}),E.length>0&&B.e.push(E),B.e.length>0){B.o=I,B.z=U,B.t=secondsToHMS(Z),H.push(B);for(N=0;N<2;N++)V[N].push(z[N]),q[N].push(X[N])}V[0].sort(function(e,t){return t-e}),V[1].sort(function(e,t){return t-e}),q[0].sort(function(e,t){return e-t}),q[1].sort(function(e,t){return e-t});var Q=1;1==V[0].length&&(Q=0);var W=[V[0][Q],V[1][Q]],$=[q[0][Q],q[1][Q]];postMessage({complete:!0}),postMessage({layers:{layers:H,maxSpeed:J,maxCoord:W,minCoord:$,maxFanSpeed:this.maxFanSpeed}}),H=void 0,V=void 0,q=void 0},this.calculateSTHistogram=function(e){for(var t=[e.phaseSpeed[0],e.phaseSpeed[1],e.phaseSpeed[1],e.phaseSpeed[2]],a=0;a<3;a++){var r=e.phaseTime[a];if(r>0){var o=t[a],i=t[a+1],s=Math.floor(o),d=Math.floor(i);if(s==d){if(this.STHistogram.length<s+1)for(var n=this.STHistogram.length;n<s+1;n++)this.STHistogram.push([n,0,0]);e.printMove?this.STHistogram[s][1]+=r:this.STHistogram[s][2]+=r}else for(var c=s;c<=d;c++){if(this.STHistogram.length<c+1)for(n=this.STHistogram.length;n<c+1;n++)this.STHistogram.push([n,0,0]);var l,h;l=0==c?o:c,h=c==d?i:c+1,e.printMove?this.STHistogram[c][1]+=r*(h-l)/(i-o):this.STHistogram[c][2]+=r*(h-l)/(i-o)}}}},this.calculateBasicMovementInfo=function(e){e.startCoord=this.currentCoord,this.absoluteExtrusion||(e.startCoord[3]=0),e.endCoord=updatedValueInNewArray(e.startCoord,e.coord);for(var t=Array(4),a=0;a<3;a++)t[a]=e.endCoord[a]-e.startCoord[a];t[3]=(e.endCoord[3]-e.startCoord[3])*this.currentExtrudeFactor,e.relativeCoord=t,this.currentCoord=e.endCoord;for(a=0;a<4;a++)if(0!=t[a]){e.isMovement=!0;break}t[3]>0&&(0!=t[0]||0!=t[1])?e.printMove=!0:e.printMove=!1,null!=e.parameters.F&&(this.currentFeedrate=e.parameters.F*this.settings.feedrateMultiplyer*this.currentSpeedFactor/6e3),e.feedrate=this.currentFeedrate,e.isMovement&&(e.previousMovementGcode=this.lastMovementGcode,e.movementGcodeIndex=this.lastMovementGcode.movementGcodeIndex+1,this.lastMovementGcode.nextMovementGcode=e,this.lastMovementGcode=e,this.movementGcodeCount++,e.calculateAxisRatio(),e.calculateSpeed(this.settings.maxSpeed),e.printMove?e.calculateAcceleration(this.currentPrintAcceleration):e.calculateAcceleration(this.currentTravelAcceleration),e.maxJerk=this.settings.maxJerk)},this.processGcode=function(e){switch(e.commandType){case"G0":case"G1":this.calculateBasicMovementInfo(e);break;case"G10":null!=e.parameters&&"P"in e.parameters||(e.parameters={},e.parameters.F=this.firmwareRetractSpeed,e.coord=this.currentCoord.slice(),this.zBeforeFirmwareRetractZhop=e.coord[2],e.coord[2]+=this.firmwareRetractZhop,this.absoluteExtrusion?e.coord[3]-=this.firmwareRetractLength:e.coord[3]=-this.firmwareRetractLength,this.calculateBasicMovementInfo(e));break;case"G11":e.parameters={},e.parameters.F=this.firmwareUnretractSpeed,e.coord=this.currentCoord.slice(),e.coord[2]=this.zBeforeFirmwareRetractZhop,this.absoluteExtrusion?e.coord[3]+=this.firmwareUnretractLength:e.coord[3]=this.firmwareUnretractLength,this.calculateBasicMovementInfo(e);break;case"M82":this.absoluteExtrusion=!0;break;case"M83":this.absoluteExtrusion=!1;break;case"M106":e.parameters.S<=1?this.currentFanSpeed=100*e.parameters.S:this.currentFanSpeed=e.parameters.S/2.55,this.currentFanSpeed>this.maxFanSpeed&&(this.maxFanSpeed=this.currentFanSpeed);break;case"M107":this.currentFanSpeed=0;break;case"G92":this.currentCoord=updatedValueInNewArray(this.currentCoord,e.coord);break;case"M201":this.currentPrintAcceleration=updatedValueInNewArray(this.currentPrintAcceleration,e.coord);break;case"M202":this.currentTravelAcceleration=updatedValueInNewArray(this.currentTravelAcceleration,e.coord);break;case"M207":null!=e.parameters.S&&(this.firmwareRetractLength=e.parameters.S,this.m208Ran||(this.firmwareUnretractLength=this.firmwareRetractLength)),null!=e.parameters.F&&(this.firmwareRetractSpeed=e.parameters.F,this.m208Ran||(this.firmwareUnretractSpeed=this.firmwareRetractSpeed)),null!=e.parameters.Z&&(this.firmwareRetractZhop=e.parameters.Z),null!=e.parameters.R&&(this.firmwareUnretractLength=this.firmwareRetractLength+e.parameters.R),null!=e.parameters.T&&(this.firmwareUnretractSpeed=e.parameters.T);break;case"M208":this.m208Ran=!0,null!=e.parameters.S&&(this.firmwareUnretractLength=e.parameters.S),null!=e.parameters.F&&(this.firmwareUnretractSpeed=e.parameters.F);break;case"M220":null!=e.parameters.S&&(this.currentSpeedFactor=e.parameters.S/100);break;case"M221":null!=e.parameters.S&&(this.currentExtrudeFactor=e.parameters.S/100)}}}onmessage=function(e){if("getResultFormat"==e.data)gcodeProcessor=new GcodeProcessor,postMessage({resultFormat:gcodeProcessor.results});else if("cleanup"==e.data)gcodeProcessor=void 0;else{var t;gcodeProcessor=new GcodeProcessor,[gcodeLines,t]=e.data,gcodeProcessor.processGcodes(gcodeLines,t)}},Gcode=function(){},Gcode.prototype.axisRatio=void 0,Gcode.prototype.commandType=void 0,Gcode.prototype.coord=void 0,Gcode.prototype.endSpeed=void 0,Gcode.prototype.feedrate=void 0,Gcode.prototype.isMovement=void 0,Gcode.prototype.indexForAccelerationCalculation=void 0,Gcode.prototype.limitedByMaxSpeed=void 0,Gcode.prototype.maxAcceleration=void 0,Gcode.prototype.maxJerk=void 0,Gcode.prototype.movementGcodeIndex=void 0,Gcode.prototype.nextMovementGcode=void 0,Gcode.prototype.parameters=void 0,Gcode.prototype.phaseDistance=void 0,Gcode.prototype.phaseSpeed=void 0,Gcode.prototype.phaseTime=void 0,Gcode.prototype.previousMovementGcode=void 0,Gcode.prototype.printMove=void 0,Gcode.prototype.reachedFeedrateScale=void 0,Gcode.prototype.relativeCoord=void 0,Gcode.prototype.startSpeed=void 0,Gcode.prototype.targetAccelerationPerAxis=void 0,Gcode.prototype.targetFeedratePerAxis=void 0,Gcode.prototype.loadGcode=function(e){var t=e.split(";")[0].trim().toUpperCase();if(0!=t.length){this.parameters={};var a=t.split(" ");this.commandType=a[0];for(var r=1;r<a.length;r++){var o=parseFloat(a[r].substring(1));isNaN(o)||(this.parameters[a[r].charAt(0)]=o)}null==this.parameters.X&&null==this.parameters.Y&&null==this.parameters.Z&&null==this.parameters.E||(this.coord=[this.parameters.X,this.parameters.Y,this.parameters.Z,this.parameters.E])}},Gcode.prototype.calculateAxisRatio=function(){this.axisRatio=Array(4);for(var e=0,t=0;t<4;t++)e+=this.relativeCoord[t]*this.relativeCoord[t];var a=Math.sqrt(e);for(t=0;t<4;t++)this.axisRatio[t]=this.relativeCoord[t]/a},Gcode.prototype.calculateSpeed=function(e){this.targetFeedratePerAxis=Array(4),this.limitedByMaxSpeed=Array(4);for(var t=1,a=0;a<4;a++)if(this.targetFeedratePerAxis[a]=this.feedrate*this.axisRatio[a],e[a]<Math.abs(this.targetFeedratePerAxis[a])){var r=e[a]/Math.abs(this.targetFeedratePerAxis[a]);this.limitedByMaxSpeed[a]=r,r<t&&(t=r)}else this.limitedByMaxSpeed[a]=1;if(1!=t)for(a=0;a<4;a++)this.targetFeedratePerAxis[a]*=t},Gcode.prototype.calculateAcceleration=function(e){this.targetAccelerationPerAxis=Array(4);for(var t=Array(4),a=1/0,r=0;r<4;r++){var o=e[r]/Math.abs(this.axisRatio[r]);t[r]=o,o<a&&(a=o)}for(r=0;r<4;r++)this.targetAccelerationPerAxis[r]=a*Math.abs(this.axisRatio[r])},Gcode.prototype.calculateTimeByAcceleration=function(){if(null==this.indexForAccelerationCalculation)for(var e=0;e<4;e++)if(0!=this.targetAccelerationPerAxis[e]){this.indexForAccelerationCalculation=e;break}var t=this.indexForAccelerationCalculation,a=a=this.targetAccelerationPerAxis[t],r=Math.abs(this.startSpeed[t]),o=Math.abs(this.targetFeedratePerAxis[t]),i=Math.abs(this.endSpeed[t]),s=Math.abs(this.relativeCoord[t]),d=0,n=0,c=0,l=0,h=0,p=0,m=void 0,v=void 0;if(o!=r?d=r*(l=(o-r)/a)+.5*a*l*l:(l=0,d=0),i!=o?c=o*(p=(i-o)/-a)+.5*-a*p*p:(p=0,c=0),d+c<=s)h=(n=s-d-c)/o,this.reachedFeedrateScale=1;else{var u=0;if(h=0,n=0,r<=i){var S=(i-r)/a;r*S+.5*a*S*S>s&&(u=1)}else{var g=(i-r)/-a;r*g+.5*-a*g*g>s&&(u=2)}0==u?(v1a=Math.sqrt((r*r+i*i)/2+a*s),d=r*(l=(v1a-r)/a)+.5*a*l*l,c=i*(p=(v1a-i)/a)+.5*a*p*p,this.reachedFeedrateScale=v1a/o,o=v1a):1==u?(v1a=Math.sqrt(2*a*s+r*r),l=(v1a-r)/a,d=s,this.reachedFeedrateScale=v1a/o,v=scaleValues(this.reachedFeedrateScale,this.targetFeedratePerAxis),c=0,o=v1a,i=v1a,p=0):(l=0,v0a=Math.sqrt(2*a*s+i*i),p=(i-v0a)/-a,this.reachedFeedrateScale=v0a/o,m=scaleValues(this.reachedFeedrateScale,this.targetFeedratePerAxis),d=0,c=s,r=v0a,o=v0a)}this.phaseTime=[l,h,p];var f=Math.abs(this.axisRatio[t]);this.phaseSpeed=[r/f,o/f,i/f],this.phaseDistance=[d/f,n/f,c/f],null!=m&&(this.startSpeed=m,this.previousMovementGcode&&this.previousMovementGcode.calculateSpeedByJerk()),null!=v&&(this.endSpeed=v,this.calculateSpeedByJerk())},Gcode.prototype.calculateSpeedByJerk=function(){var e,t,a,r,o=void 0,i=void 0;o=null!=this.endSpeed?this.endSpeed:this.targetFeedratePerAxis,i=null!=this.nextMovementGcode.startSpeed?this.nextMovementGcode.startSpeed:this.nextMovementGcode.targetFeedratePerAxis,e=o.slice(),t=i.slice(),a=o.slice(),r=i.slice();for(var s=!1;!s;){for(var d=0;d<4;d++)if(Math.abs(e[d]-t[d])>this.nextMovementGcode.maxJerk[d])switch(sameSign(e[d],t[d])){case void 0:case!0:if(Math.abs(e[d])>Math.abs(t[d]))e=scaleValues(h=(Math.abs(t[d])+this.nextMovementGcode.maxJerk[d])/Math.abs(e[d]),e);else t=scaleValues(h=(Math.abs(e[d])+this.nextMovementGcode.maxJerk[d])/Math.abs(t[d]),t);break;case!1:if(0==this.nextMovementGcode.maxJerk[d])r=t=[0,0,0,0],a=e=[0,0,0,0];else e=scaleValues(h=this.nextMovementGcode.maxJerk[d]/Math.abs(e[d]-t[d]),e),t=scaleValues(h,t)}var n=-1,c=-1;for(d=0;d<4;d++)switch(sameSign(e[d],t[d])){case!0:if(e[d]==t[d])n=1,c=1;else if(Math.abs(e[d])>Math.abs(t[d])){(l=t[d]/e[d])>c&&(c=l)}else{var l;(l=e[d]/t[d])>n&&(n=l)}break;case!1:c<0&&(c=0),n<0&&(n=0)}if(n>0||c>0)n>c?n<.999&&(t=scaleValues(n,t)):c<.999&&(e=scaleValues(c,e));else if(0==n&&0==c){t=[0,0,0,0],e=[0,0,0,0];break}s=!0;for(d=0;d<4;d++){var h;if(0!=a[d]&&0!=e[d])((h=a[d]/e[d])>1.01||h<.99)&&a[d]-e[d]>1e-4&&(s=!1);if(0!=r[d]&&0!=t[d])((h=r[d]/t[d])>1.01||h<.99)&&r[d]-t[d]>1e-4&&(s=!1)}a=e.slice(),r=t.slice()}null==this.endSpeed?this.endSpeed=e:arrayEqual(this.endSpeed,e)||(this.endSpeed=e,this.calculateTimeByAcceleration()),null==this.nextMovementGcode.startSpeed?this.nextMovementGcode.startSpeed=t:arrayEqual(this.nextMovementGcode.startSpeed,t)||(this.nextMovementGcode.startSpeed=t,null!=this.nextMovementGcode.endSpeed&&this.nextMovementGcode.calculateTimeByAcceleration())};